This readme includes the steps about how to run the 17 networks clustering algorithm of Yeo et al., 2011 to check if your preprocessing results are fine. To run this clustering algorithm, you can use the preprocessed data which are mentioned below, or use the data of the same subjects but preprocessed by different pipelines(with the same or different configuration file).

Notice that all the filenames and directories below work for CBIG lab only. It is assumed that the input surface data are in `fsaverage5` space.

----

## Data

- Data set

The `CBIG_fMRI_Preproc2016` preprocessing scripts use the Brain Genomics Superstruct Project (GSP) data as a baseline data set. All data mentioned here are based on GSP data set.

GSP data contain both structual MRI (T1) and functional MRI (T2*). All subjects (N = 1570) are healthy, young subjects (age: 18-35). The preprocessed (by `recon-all`) structual MRI data and raw functional MRI are in this folder:

```
/mnt/eql/yeo1/data/GSP_release
```

where the folder names with `_FS` (e.g. `Sub0001_Ses1_FS`) meaning they are structual MRI data after `recon-all` processing, and the folder names without `_FS` (e.g. `Sub0001_Ses1`) meaning they are raw functional MRI data.

- Subject list

In total, 100 subjects were chosen to perform the clustering algorithm. To choose the 100 subjects, all GSP subjects (in total 1482 subjects after a preprocessing pipeline configured by `/mnt/eql/yeo3/data/GSP2016/CBIG_preproc_global_cen_bp/GSP_single_session/scripts/prepro.config`) were sorted by their mean framewise displacement from low to high. The first 80 subjects were selected, and the residual 20 subjects were picked after the 600-th one so that the 100 subjects are a mixture of low-motion and high-motion subjects. The subject list is:

```
/mnt/eql/yeo3/data/GSP2016/CBIG_preproc_global_cen_bp/GSP_single_session/clustering/scripts/GSP_80_low_motion+20_w_censor.txt
```

- Preprocessed data

The clustering results mentioned in this readme are based on the preprocessed fMRI data in this folder:

```
/mnt/eql/yeo3/data/GSP2016/CBIG_preproc_global_cen_bp/GSP_single_session/CBIG2016_preproc_global_cen_bp
```

----

## Code

The clustering results mentioned here are generated by using this command

```
/mnt/eql/yeo3/data/GSP2016/CBIG_preproc_global_cen_bp/GSP_single_session/clustering/scripts/CBIG_general_cluster_GSP_80_low_motion+20_w_censor.csh 17 1
```

where `17` means 17 networks, and `1` means when the functional connectivities are computed, the high-motion frames are removed.

To run the clustering algorithm on your preprocessed data, you only need to change `data_dir`, `subject_dir`, and `out_dir` in `/mnt/eql/yeo3/data/GSP2016/CBIG_preproc_global_cen_bp/GSP_single_session/clustering/scripts/CBIG_general_cluster_GSP_80_low_motion+20_w_censor.csh`. For current specification of these variables, please check this clustering wrapper script.

----

## Results

- The 17 network clustering result of the 100 subjects is:

```
/mnt/eql/yeo3/data/GSP2016/CBIG_preproc_global_cen_bp/GSP_single_session/clustering/GSP_80_low_mt_20_w_censor_clusters017_scrub.mat
```

- To compare this clustering result with your own result, use the Hungarian matching function in matlab:

```
ref_file = '/mnt/eql/yeo3/data/GSP2016/CBIG_preproc_global_cen_bp/GSP_single_session/clustering/GSP_80_low_mt_20_w_censor_clusters017_scrub.mat';
input_file = '<Your clustering .mat file>'
output_file = '<Some file name>'
CBIG_HungarianClusterMatchSurfWrapper(ref_file, input_file, output_file)
```

The Hungarian matching function will print the cost and Dice overlap between `ref_file` and `input_file`. The results will be treated as ok if the cost is around -18000 and the dice overlap for each network is around or above 0.95.

- You can also plot your clustering results on the surface by using Yeo et al. 2011 17 networks' colors in matlab.

```
clustered = load('<Your clustering .mat file>');
ref_file = [<Your CBIG_CODE_DIR> '/stable_projects/brain_parcellation/Yeo2011_fcMRI_clustering/1000subjects_reference/1000subjects_clusters017_ref.mat'];
ref = load(ref_file);
CBIG_DrawSurfaceMaps(clustered.lh_labels, clustered.rh_labels, 'fsaverage5','inflated',0, 17, ref.colors)
```

----

## References

- Yeo, BT Thomas, et al. "The organization of the human cerebral cortex estimated by intrinsic functional connectivity." Journal of neurophysiology 106.3 (2011): 1125-1165.

- Holmes, Avram J., et al. "Brain Genomics Superstruct Project initial data release with structural, functional, and behavioral measures." Scientific data 2 (2015).
